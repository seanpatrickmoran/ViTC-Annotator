# ViTC-Annotator, a HiC Image Labeling Tool

A PyQt5-based graphical interface for efficient labeling and annotation of Hi-C chromatin interaction images stored in SQLite databases.

## Overview

This tool provides an intuitive interface for labeling Hi-C images with categories like "Strong Positive", "Weak Positive", "Weak Negative", "Negative", and "Noise". It's designed to work with SQLite databases containing Hi-C image data, particularly those generated by tools like [Strainer](https://github.com/seanpatrickmoran/strainer).

## Features

- **Grid-based Image Display**: View and label up to 25 images simultaneously in a 5x5 grid
- **Multi-selection Support**: Select multiple images at once using click, shift-click, or drag selection
- **Keyboard Shortcuts**: Quick labeling with number keys (1-5) and other shortcuts
- **Batch Operations**: Apply labels to multiple images simultaneously
- **Smart Filtering**: Filter samples by resolution and dataset combinations
- **Key ID Search**: Search and label specific images by their key IDs
- **Progress Tracking**: Monitor labeling progress across different dataset combinations
- **Auto-save**: Automatically saves labels after reaching a threshold
- **Database Management**: Handle multiple source databases from a central interface

## Requirements

### Python Dependencies
```bash
pip install PyQt5
pip install numpy
pip install torch
pip install Pillow
pip install matplotlib
pip install pathlib
```

### Database Requirements

The tool expects SQLite databases with an `imag_with_seqs` table containing:
- `key_id` (INTEGER): Unique identifier for each image
- `numpyarr` (BLOB): Serialized numpy array of the image data
- `resolution` (INTEGER): Resolution parameter
- `viewing_vmax` (REAL): Maximum value for visualization
- `dataset` (TEXT): Dataset identifier
- `hic_path` (TEXT): Path to original Hi-C file
- `labels` (TEXT): Label assignments (will be added if not present)

Databases in this format can be generated using [Strainer](https://github.com/seanpatrickmoran/strainer).

## Installation

1. Clone this repository:
```bash
git clone https://github.com/seanpatrickmoran/ViTC-Annotator.git
cd ViTC-Annotator
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

## Usage

1. **Launch the application**:
```bash
python InterfaceGUI_v0.0.13.py
```

2. **Add a source database**:
   - Click "ADD SOURCE DATABASE"
   - Select your SQLite database file
   - Configure sampling options (number of samples, random/sequential, filtering)

3. **Start labeling**:
   - Select a database from the list and click "OPEN SELECTED"
   - Use the annotation tab for sequential labeling
   - Use the Key ID Search tab to find specific images

4. **Labeling workflow**:
   - Select images by clicking, shift-clicking, or dragging
   - Choose a label category (or press keys 1-5)
   - Click "APPLY TO SELECTED" or press Enter
   - Labels are queued and saved automatically or manually

### Keyboard Shortcuts

- **1-5**: Apply corresponding label to selected images
- **C/Delete**: Clear labels from selected images
- **Ctrl+A**: Select all images
- **Escape**: Clear selection
- **Enter**: Apply selected label
- **Ctrl+S**: Save pending labels to database

## Database Structure

### Labeling Database (hic_labeling.db)
The tool creates a local SQLite database to track:
- Source database references
- Sample indices and splits (train/val/test)
- Label assignments
- Label categories

### Source Database Modifications
The tool adds a `labels` column to the source database's `imag_with_seqs` table if it doesn't exist, storing label assignments directly with the image data.

## Filtering Modes

- **Dumb Mode**: Random or sequential sampling from entire database
- **Smart Mode**: Filter by resolution and dataset combinations, ensuring balanced sampling across different experimental conditions

## Output

Labels are saved in two places:
1. **Source database**: In the `labels` column of the `imag_with_seqs` table
2. **Labeling database**: In the `labels` table for tracking and management

## License

MIT

## Citation

If you use this tool in your research, please let me know!


## Acknowledgments

This tool is designed to work with databases generated by [Strainer](https://github.com/seanpatrickmoran/strainer) for Hi-C image analysis.
